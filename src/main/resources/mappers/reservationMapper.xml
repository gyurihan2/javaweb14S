<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.javaweb14S.dao.ReservationDAO">
<!-- Select -->
	<!-- 달력에 표시할 스케줄 리스트 -->
	<select id="getTheater" resultType="theaterVO">
		select *,  (select price from thema where idx=themaIdx) as themaPrice from theater where idx = #{theaterIdx}
	</select>
	<select id="getMovie" resultType="MovieVO">
		select * from movie where idx = #{movieIdx}
	</select>
	<select id="getSchedule" resultType="scheduleVO">
		select * from schedule where idx = #{scheduleIdx}
	</select>
	<!-- 좌석 정보 -->
	<select id="getSeatInfoList" resultType="String">
		select seatInfo from reservation where groupId = #{groupId}
	</select>
		
<!-- Insert -->
	<insert id="setReservationInput">
		insert into reservation values(#{vo.idx},#{vo.groupId},#{vo.scheduleIdx},#{vo.memberMid},#{vo.seatInfo},#{vo.adultCnt},#{vo.childCnt},now());
	</insert>
	
<!-- Update -->
	<!-- 예약 시 남은 좌석수 업데이트 -->
	<update id="setLeftSeatSub">
		update schedule set leftSeat=(leftSeat-#{peapleCnt}) where idx=#{scheduleIdx};
	</update>
	<update id="setLeftSeatAdd">
		update schedule set leftSeat=(leftSeat+#{peapleCnt}) where idx=#{scheduleIdx};
	</update>
	
	
<!-- Delete -->
	<delete id="setReservationDelete">
		delete from reservation where idx=#{idx};
	</delete>
</mapper>